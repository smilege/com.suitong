(function() {
    'use strict';

    angular
        .module('devplatformApp')
        .controller('${entityName}Controller', ${entityName}Controller);

    ${entityName}Controller.$inject = ['${entityName}Service', 'ngDialog', '$state', '$scope', '$timeout', 'PublicService'];

    function ${entityName}Controller(${entityName}Service, ngDialog, $state, $scope, $timeout, PublicService) {
        $scope.formParam = {};
		$scope.datePickerOpenStatus = {};
        $scope.tablesConfig = {
            showCheckBox:true,
			tableWidth:'table-default-width',
            tableTitles:[
			#foreach ($entity in $listField)
				#set($name ="$entity.name")
				#set($code ="$entity.code")
				#set($type ="entity.componentType")
				
				#if(${type}=="date")
                {title:"${name}", filed: '${code}',type:'date',width:'table-item-pre-1'},  
				#else
				{title:"${name}", filed: '${code}',type:'text',width:'table-item-pre-1'},    
			   #end		
			#end
                {title:"entity.action.operation",filed:'operation',type:'btn',width:'table-item-pre-1',actions:[
			#foreach ($part in $needPart)
                #if($part=="save")
                    {actionName:'edit${entityName}(item.id)',name:'entity.action.edit'},
                #elseif($part=="detail") 
                    {actionName:'show${entityName}(item.id)',name:'entity.action.detail'},
                #elseif($part=="delete") 
                    {actionName:'delete${entityName}(item.id)',name:'entity.action.delete'}
	 			#end		
			#end
                    ]}
                    ],
            url:'api/${formatEntityName}/list${entityName}',
            
			formParams:{
				#foreach ($entity in $searchField)
					#set($name ="$entity.name")
					#set($componentType ="$entity.componentType")
						${name} : $scope.formParam.${name},					
				   #end		
			}
		};

 	#set($count = 0)
		#foreach ($entity in $searchField)
			#if($entity.componentType)		
		#end		
		
		<%_ if (count!=0){ _%>
			$scope.loadAll = function() {
				$scope.refreshTableList($scope.formParam);
				};	
		<%_}_%>

		$scope.resetSearch = function() {
			$scope.formParam = {};
			};
			
		<%_ var t=0;
			for (idx in fields) {
				const fieldType = fields[idx].fieldType;				   
				if (fields[idx].javadoc != null) {						
					if(['Instant', 'ZonedDateTime', 'LocaleDate'].includes(fieldType)){
						t++;
					}
				}
			}
			_%>
		
		<%_ if (t!=0){ _%>
			$scope.openCalendar = function (date) {
				$scope.datePickerOpenStatus[date] = true;
			};
		<%_}_%>
		
		$scope.confirmDelete = function(id){
			 ${entityName}Service.delete<%= entityClass %>(id)
				.then(function (response){
					if(response.statusCode === "0000"){
						$scope.loadAll();
					}
				});
		};
		
		
		$scope.delete${entityName} = function(id) {
			var msg = "global.messages.deleteConfirm";
			PublicService.showConfirmDialog(msg, "confirmDelete", $scope, id);
        };
		
		
		  $scope.batchDelete = function() {
        	$scope.choseArr = $scope.getCheckValues('delFlag').check;
        	$scope.choseArrParam = $scope.getCheckValues('delFlag').checkedParamFlags;
        	var msg = "global.messages.deleteConfirm";
        	PublicService.showConfirmDialog(msg, "confirmBatchDelete", $scope, $scope.checked);
        };
        
        $scope.confirmBatchDelete = function(checkeds){
        	var delObj = {"ids":checkeds};
			 ${entityName}Service.batchDelete<%= entityClass %>(delObj)
				.then(function (response){
					if(response.statusCode === "0000"){
						$scope.loadAll();
					}
				});
		};
		
		
		
        $scope.add${entityName} = function(){
            $state.go('app.<%= entityStateName %>-edit',{id:null});
        };

        $scope.edit${entityName} = function (id) {
            $state.go('app.<%= entityStateName %>-edit',{id:id});
        };
		
		$scope.show${entityName} = function (id) {
        	$state.go('app.<%= entityStateName %>-detail',{id:id});
        };

    }
})();
